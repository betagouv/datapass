{"version":3,"file":"scheme.module.min.js","sources":["../../.config/config.js","../../src/core/api.js","../../src/scheme/script/scheme/scheme-value.js","../../src/scheme/script/scheme/scheme-attribute.js","../../src/scheme/script/scheme/scheme-theme.js","../../src/scheme/script/scheme/scheme-emission.js","../../src/scheme/script/scheme/scheme.js","../../src/core/script/api/utilities/propertie.js","../../src/scheme/script/scheme/scheme-selector.js","../../src/scheme/index.js","../../src/scheme/main.js"],"sourcesContent":["const config = {\r\n  prefix: 'fr',\r\n  namespace: 'dsfr',\r\n  organisation: '@gouvfr',\r\n  version: '1.2.1'\r\n};\r\n\r\nexport default config;\r\n","import config from './config.js';\nconst api = window[config.namespace];\nexport default api;\n","export const SchemeValue = {\n  SYSTEM: 'system',\n  LIGHT: 'light',\n  DARK: 'dark'\n};\n","import api from '../../api';\n\nexport const SchemeAttribute = {\n  THEME: api.ns.attr('theme'),\n  SCHEME: api.ns.attr('scheme'),\n  TRANSITION: api.ns.attr('transition')\n};\n","export const SchemeTheme = {\n  LIGHT: 'light',\n  DARK: 'dark'\n};\n","import api from '../../api';\n\nexport const SchemeEmission = {\n  SCHEME: api.ns.emission('scheme', 'scheme'),\n  THEME: api.ns.emission('scheme', 'theme'),\n  ASK: api.ns.emission('scheme', 'ask')\n};\n","import api from '../../api.js';\nimport { SchemeValue } from './scheme-value.js';\nimport { SchemeAttribute } from './scheme-attribute.js';\nimport { SchemeTheme } from './scheme-theme.js';\nimport { SchemeEmission } from './scheme-emission.js';\nimport { completeAssign } from '../../../core/script/api/utilities/propertie';\n\nclass Scheme extends api.core.Instance {\n  constructor () {\n    super(false);\n  }\n\n  static get instanceClassName () {\n    return 'Scheme';\n  }\n\n  init () {\n    this.changing = this.change.bind(this);\n\n    if (this.hasAttribute(SchemeAttribute.TRANSITION)) {\n      this.removeAttribute(SchemeAttribute.TRANSITION);\n      this.request(this.restoreTransition.bind(this));\n    }\n\n    const scheme = localStorage.getItem('scheme');\n    const schemeAttr = this.getAttribute(SchemeAttribute.SCHEME);\n\n    switch (scheme) {\n      case SchemeValue.DARK:\n      case SchemeValue.LIGHT:\n      case SchemeValue.SYSTEM:\n        this.scheme = scheme;\n        break;\n\n      default:\n        switch (schemeAttr) {\n          case SchemeValue.DARK:\n            this.scheme = SchemeValue.DARK;\n            break;\n\n          case SchemeValue.LIGHT:\n            this.scheme = SchemeValue.LIGHT;\n            break;\n\n          default:\n            this.scheme = SchemeValue.SYSTEM;\n        }\n    }\n\n    this.addAscent(SchemeEmission.ASK, this.ask.bind(this));\n    this.addAscent(SchemeEmission.SCHEME, this.apply.bind(this));\n  }\n\n  get proxy () {\n    const scope = this;\n\n    const proxyAccessors = {\n      get scheme () {\n        return scope.scheme;\n      },\n      set scheme (value) {\n        scope.scheme = value;\n      }\n    };\n\n    return completeAssign(super.proxy, proxyAccessors);\n  }\n\n  restoreTransition () {\n    this.setAttribute(SchemeAttribute.TRANSITION, '');\n  }\n\n  ask () {\n    this.descend(SchemeEmission.SCHEME, this.scheme);\n  }\n\n  apply (value) {\n    this.scheme = value;\n  }\n\n  get scheme () {\n    return this._scheme;\n  }\n\n  set scheme (value) {\n    if (this._scheme === value) return;\n    this._scheme = value;\n    switch (value) {\n      case SchemeValue.SYSTEM:\n        this.listenPreferences();\n        break;\n\n      case SchemeValue.DARK:\n        this.unlistenPreferences();\n        this.theme = SchemeTheme.DARK;\n        break;\n\n      case SchemeValue.LIGHT:\n        this.unlistenPreferences();\n        this.theme = SchemeTheme.LIGHT;\n        break;\n\n      default:\n        this.scheme = SchemeValue.SYSTEM;\n        return;\n    }\n\n    this.descend(SchemeEmission.SCHEME, value);\n    localStorage.setItem('scheme', value);\n    this.setAttribute(SchemeAttribute.SCHEME, value);\n  }\n\n  get theme () {\n    return this._theme;\n  }\n\n  set theme (value) {\n    if (this._theme === value) return;\n    switch (value) {\n      case SchemeTheme.LIGHT:\n      case SchemeTheme.DARK:\n        this._theme = value;\n        this.setAttribute(SchemeAttribute.THEME, value);\n        this.descend(SchemeEmission.THEME, value);\n        break;\n    }\n  }\n\n  listenPreferences () {\n    if (this.isListening) return;\n    this.isListening = true;\n    this.mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');\n    this.mediaQuery.addEventListener('change', this.changing);\n    this.change();\n  }\n\n  unlistenPreferences () {\n    if (!this.isListening) return;\n    this.isListening = false;\n    this.mediaQuery.removeEventListener('change', this.changing);\n    this.mediaQuery = null;\n  }\n\n  change () {\n    if (!this.isListening) return;\n    this.theme = this.mediaQuery.matches ? SchemeTheme.DARK : SchemeTheme.LIGHT;\n  }\n\n  mutate (attributeNames) {\n    if (attributeNames.indexOf(SchemeAttribute.SCHEME) > -1) this.scheme = this.getAttribute(SchemeAttribute.SCHEME);\n    if (attributeNames.indexOf(SchemeAttribute.THEME) > -1) this.theme = this.getAttribute(SchemeAttribute.THEME);\n  }\n\n  dispose () {\n    this.unlistenPreferences();\n  }\n}\n\nexport { Scheme };\n","/**\n * Copy properties from multiple sources including accessors.\n * source : https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Global_Objects/Object/assign#copier_des_accesseurs\n *\n * @param {object} [target] - Target object to copy into\n * @param {...objects} [sources] - Multiple objects\n * @return {object} A new object\n *\n * @example\n *\n *     const obj1 = {\n *        key: 'value'\n *     };\n *     const obj2 = {\n *        get function01 () {\n *          return a-value;\n *        }\n *        set function01 () {\n *          return a-value;\n *        }\n *     };\n *     completeAssign(obj1, obj2)\n */\nconst completeAssign = (target, ...sources) => {\n  sources.forEach(source => {\n    const descriptors = Object.keys(source).reduce((descriptors, key) => {\n      descriptors[key] = Object.getOwnPropertyDescriptor(source, key);\n      return descriptors;\n    }, {});\n\n    Object.getOwnPropertySymbols(source).forEach(sym => {\n      const descriptor = Object.getOwnPropertyDescriptor(source, sym);\n      if (descriptor.enumerable) {\n        descriptors[sym] = descriptor;\n      }\n    });\n    Object.defineProperties(target, descriptors);\n  });\n  return target;\n};\n\nexport { completeAssign };\n","import api from '../../api.js';\n\nexport const SchemeSelector = {\n  SCHEME: `:root${api.ns.attr.selector('theme')}, :root${api.ns.attr.selector('scheme')}`,\n  SWITCH_THEME: api.ns.selector('switch-theme'),\n  RADIO_BUTTONS: `input[name=\"${api.ns('radios-theme')}\"]`\n};\n","import api from './api.js';\nimport { Scheme } from './script/scheme/scheme.js';\nimport { SchemeValue } from './script/scheme/scheme-value.js';\nimport { SchemeSelector } from './script/scheme/scheme-selector.js';\nimport { SchemeEmission } from './script/scheme/scheme-emission.js';\nimport { SchemeTheme } from './script/scheme/scheme-theme.js';\n\napi.scheme = {\n  Scheme: Scheme,\n  SchemeValue: SchemeValue,\n  SchemeSelector: SchemeSelector,\n  SchemeEmission: SchemeEmission,\n  SchemeTheme: SchemeTheme\n};\n\nexport default api;\n","import api from './index.js';\n\napi.register(api.scheme.SchemeSelector.SCHEME, api.scheme.Scheme);\n\nexport default api;\n"],"names":["api","window","SchemeValue","SYSTEM","LIGHT","DARK","SchemeAttribute","THEME","ns","attr","SCHEME","TRANSITION","SchemeTheme","SchemeEmission","emission","ASK","Scheme","core","Instance","constructor","super","instanceClassName","init","this","changing","change","bind","hasAttribute","removeAttribute","request","restoreTransition","scheme","localStorage","getItem","schemeAttr","getAttribute","addAscent","ask","apply","proxy","scope","proxyAccessors","value","target","sources","forEach","source","descriptors","Object","keys","reduce","key","getOwnPropertyDescriptor","getOwnPropertySymbols","sym","descriptor","enumerable","defineProperties","completeAssign","setAttribute","descend","_scheme","listenPreferences","unlistenPreferences","theme","setItem","_theme","isListening","mediaQuery","matchMedia","addEventListener","removeEventListener","matches","mutate","attributeNames","indexOf","dispose","SchemeSelector","selector","SWITCH_THEME","RADIO_BUTTONS","register"],"mappings":"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"}